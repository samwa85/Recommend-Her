import{c as le,u as fe,f as Ne,r as t,j as e,B as l,a as K,X as ve,E as we,h as Ce}from"./index-qoOME8mY.js";import{B as Q}from"./badge-DS90lYj3.js";import{I as z}from"./input-COdB9PMO.js";import{T as Se}from"./textarea-D1tOqvpc.js";import{t as O,T as ye,a as be,b as W,c as v,d as ke,e as w,A as De,f as _e,g as Re}from"./table-K5LBk1_9.js";import{S as Z,a as ee,b as se,c as ae,d as L}from"./select-D7YwqkvP.js";import{D as Ae,a as Ee,b as Me,c as C,d as Te}from"./parseISO-Dkgfv3AF.js";import{D as Pe,a as Fe,b as Ie,c as Ue,d as ze,e as Oe}from"./dialog-au1fJFZW.js";import{B as Le,C as $e,M as n,A as Be,D as He,h as Ve,i as D,f as Ge,k as Xe,l as Ye,m as qe,n as Je,o as Ke}from"./LoadingSkeleton-BIuzlw0E.js";import{C as _,a as R,b as A,d as E}from"./index-CsKqCIzL.js";import{S as Qe}from"./scroll-area-D5JBEXsZ.js";import{S as te}from"./StatusBadge-0beuKaZt.js";import{S as We}from"./search-BPQDrF8n.js";import{F as Ze}from"./funnel-UMXFXVhw.js";import{C as es}from"./clock-DdojzwLk.js";import{E as ss,T as $}from"./trash-2-B2GZL5i8.js";import{C as as}from"./circle-check-big-BDlXIym8.js";import{A as ts}from"./archive-B488u7aX.js";import{M as re}from"./mail-hjAr2Bly.js";import{P as rs}from"./phone-PL7MGQ3K.js";import{S as ls}from"./send-BtvLBpmG.js";import"./tslib.es6-ByNH4KU3.js";import"./index-C7Xr5Zjk.js";import"./index-EHAx_rFm.js";import"./index-Bq8Hpwnx.js";import"./users-B7vsRM7J.js";import"./building-2-LyC4uWQT.js";import"./message-square-CE0bfcV6.js";import"./shield-CPwMl-BC.js";import"./bell-B4cYDKmo.js";import"./skeleton-Br7kL-uo.js";const ns=[["polyline",{points:"22 12 16 12 14 15 10 15 8 12 2 12",key:"o97t9d"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}]],is=le("inbox",ns);const cs=[["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}],["path",{d:"m9 17-5-5 5-5",key:"nvlc11"}]],B=le("reply",cs),ds=[10,25,50,100];function $s(){fe();const[H,S]=Ne(),[ne,M]=t.useState(null),[ie,T]=t.useState(!1),[ce,P]=t.useState(new Set),[F,de]=t.useState(!1),[c,V]=t.useState({status:H.get("status")||"",search:H.get("search")||"",date_from:"",date_to:""}),[I,oe]=t.useState(!1),[G,me]=t.useState({key:"created_at",direction:"desc"}),[i,u]=t.useState({page:1,perPage:25}),[y,p]=t.useState(""),[xe,x]=t.useState(!1),[he,j]=t.useState(!1),{data:d,isLoading:ue,error:X,refresh:o}=Le({filters:{status:c.status||void 0,search:c.search||void 0},pagination:{page:i.page,perPage:i.perPage},autoRefresh:!0}),{data:r,updateStatus:h}=$e(ne),g=Object.values(c).filter(Boolean).length;ce.size>0;const pe=d.data.filter(s=>s.status===n.UNREAD).length,f=t.useCallback((s,a)=>{V(N=>({...N,[s]:a})),u(N=>({...N,page:1}));const m=new URLSearchParams;Object.entries({...c,[s]:a}).forEach(([N,J])=>{J&&m.set(N,J)}),S(m)},[c,S]),Y=t.useCallback(()=>{V({status:"",search:"",date_from:"",date_to:""}),u(s=>({...s,page:1})),S(new URLSearchParams)},[S]),b=t.useCallback(s=>{me(a=>({key:s,direction:a.key===s&&a.direction==="asc"?"desc":"asc"}))},[]);t.useCallback(s=>{P(a=>{const m=new Set(a);return m.has(s)?m.delete(s):m.add(s),m})},[]),t.useCallback(()=>{P(F?new Set:new Set(d.data.map(s=>s.id))),de(!F)},[F,d.data]);const U=t.useCallback(async s=>{M(s.id),x(!1),p(""),s.status===n.UNREAD&&(await h(n.READ),o()),T(!0)},[h,o]),q=t.useCallback(async(s,a)=>{O.promise(async()=>{if((await h(a)).success)return o(),`Message ${a}`;throw new Error("Failed to update status")},{loading:"Updating...",success:`Message marked as ${a}`,error:"Failed to update message"})},[h,o]),je=t.useCallback(async()=>{y.trim()&&O.promise(async()=>(await h(n.REPLIED),x(!1),p(""),o(),"Reply sent"),{loading:"Sending reply...",success:"Reply sent successfully",error:"Failed to send reply"})},[y,h,o]),ge=t.useCallback(async()=>{j(!1),T(!1),M(null),O.success("Message deleted"),o()},[o]),k=s=>G.key!==s?e.jsx(De,{className:"w-3.5 h-3.5 text-muted-foreground/50"}):G.direction==="asc"?e.jsx(_e,{className:"w-3.5 h-3.5 text-primary"}):e.jsx(Re,{className:"w-3.5 h-3.5 text-primary"});return e.jsxs(Be,{title:"Messages",subtitle:`${d.count} total messages â€¢ ${pe} unread`,actions:e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(l,{variant:"outline",size:"sm",onClick:o,children:[e.jsx(Ce,{className:"w-4 h-4 mr-2"}),"Refresh"]})}),children:[X&&e.jsxs("div",{className:"mb-4 p-4 rounded-lg bg-red-50 text-red-600 text-sm",children:[X,e.jsx(l,{variant:"link",onClick:o,className:"ml-2",children:"Retry"})]}),e.jsxs("div",{className:"mb-6 space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("div",{className:"relative flex-1 min-w-[300px] max-w-md",children:[e.jsx(We,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(z,{placeholder:"Search messages...",value:c.search,onChange:s=>f("search",s.target.value),className:"pl-9"})]}),e.jsxs(l,{variant:"outline",size:"sm",onClick:()=>oe(!I),className:K(I&&"bg-muted"),children:[e.jsx(Ze,{className:"w-4 h-4 mr-2"}),"Filters",g>0&&e.jsx(Q,{variant:"secondary",className:"ml-2",children:g})]}),e.jsx("div",{className:"flex-1"}),e.jsxs(Z,{value:i.perPage.toString(),onValueChange:s=>u(a=>({...a,perPage:parseInt(s),page:1})),children:[e.jsx(ee,{className:"w-[100px]",children:e.jsx(se,{})}),e.jsx(ae,{children:ds.map(s=>e.jsxs(L,{value:s.toString(),children:[s," / page"]},s))})]})]}),I&&e.jsx("div",{className:"p-4 bg-muted/50 rounded-lg space-y-3",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs(Z,{value:c.status,onValueChange:s=>f("status",s),children:[e.jsx(ee,{className:"w-[160px]",children:e.jsx(se,{placeholder:"Status"})}),e.jsxs(ae,{children:[e.jsx(L,{value:"",children:"All Status"}),Object.entries(He).map(([s,a])=>e.jsx(L,{value:s,children:a},s))]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(es,{className:"w-4 h-4 text-muted-foreground"}),e.jsx(z,{type:"date",placeholder:"From",value:c.date_from,onChange:s=>f("date_from",s.target.value),className:"w-[140px]"}),e.jsx("span",{className:"text-muted-foreground",children:"to"}),e.jsx(z,{type:"date",placeholder:"To",value:c.date_to,onChange:s=>f("date_to",s.target.value),className:"w-[140px]"})]}),e.jsx(l,{variant:"ghost",size:"sm",onClick:Y,children:"Clear Filters"})]})}),g>0&&e.jsx("div",{className:"flex flex-wrap items-center gap-2",children:Object.entries(c).filter(([s,a])=>a).map(([s,a])=>e.jsxs(Q,{variant:"secondary",className:"gap-1 pr-1 cursor-pointer hover:bg-secondary/80",onClick:()=>f(s,""),children:[s,": ",a,e.jsx(ve,{className:"w-3 h-3 ml-1"})]},s))})]}),ue?e.jsx(Ve,{columns:5,rows:5}):d.data.length===0?e.jsxs("div",{className:"text-center py-16",children:[e.jsx(is,{className:"w-16 h-16 text-muted-foreground/50 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium",children:"No messages found"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:g>0?"Try adjusting your filters":"Your inbox is empty"}),g>0&&e.jsx(l,{variant:"outline",className:"mt-4",onClick:Y,children:"Clear Filters"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"rounded-md border",children:e.jsxs(ye,{children:[e.jsx(be,{children:e.jsxs(W,{className:"bg-muted/50 hover:bg-muted/50",children:[e.jsx(v,{className:"cursor-pointer",onClick:()=>b("sender_name"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["From",k("sender_name")]})}),e.jsx(v,{className:"cursor-pointer",onClick:()=>b("subject"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["Subject",k("subject")]})}),e.jsx(v,{className:"cursor-pointer",onClick:()=>b("status"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["Status",k("status")]})}),e.jsx(v,{className:"cursor-pointer",onClick:()=>b("created_at"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["Received",k("created_at")]})}),e.jsx(v,{className:"w-10"})]})}),e.jsx(ke,{children:d.data.map(s=>e.jsxs(W,{className:K("group cursor-pointer",s.status===n.UNREAD&&"bg-blue-50/50"),onClick:()=>U(s),children:[e.jsx(w,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`
                          w-10 h-10 rounded-full flex items-center justify-center text-sm font-medium
                          ${s.status===n.UNREAD?"bg-blue-100 text-blue-600":"bg-gray-100 text-gray-600"}
                        `,children:s.sender_name.split(" ").map(a=>a[0]).join("").slice(0,2).toUpperCase()}),e.jsxs("div",{children:[e.jsx("p",{className:`font-medium ${s.status===n.UNREAD?"text-foreground":""}`,children:s.sender_name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.sender_email})]})]})}),e.jsx(w,{children:e.jsxs("div",{children:[e.jsx("p",{className:`truncate max-w-[300px] ${s.status===n.UNREAD?"font-semibold":""}`,children:s.subject||"(No Subject)"}),e.jsxs("p",{className:"text-xs text-muted-foreground truncate max-w-[300px]",children:[s.message.substring(0,60),s.message.length>60?"...":""]})]})}),e.jsx(w,{children:e.jsx(te,{status:s.status,type:"message"})}),e.jsxs(w,{children:[e.jsx("div",{className:"text-sm",children:D(s.created_at)}),e.jsx("div",{className:"text-xs text-muted-foreground",children:Ge(s.created_at)})]}),e.jsx(w,{onClick:a=>a.stopPropagation(),children:e.jsxs(Ae,{children:[e.jsx(Ee,{asChild:!0,children:e.jsx(l,{variant:"ghost",size:"icon",className:"h-8 w-8 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(ss,{className:"w-4 h-4"})})}),e.jsxs(Me,{align:"end",children:[e.jsxs(C,{onClick:()=>U(s),children:[e.jsx(we,{className:"w-4 h-4 mr-2"}),"View"]}),s.status===n.UNREAD&&e.jsxs(C,{onClick:()=>q(s,n.READ),children:[e.jsx(as,{className:"w-4 h-4 mr-2"}),"Mark as Read"]}),e.jsxs(C,{onClick:()=>{U(s),x(!0)},children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Reply"]}),s.status!==n.ARCHIVED&&e.jsxs(C,{onClick:()=>q(s,n.ARCHIVED),children:[e.jsx(ts,{className:"w-4 h-4 mr-2"}),"Archive"]}),e.jsx(Te,{}),e.jsxs(C,{className:"text-red-600",onClick:()=>{M(s.id),j(!0)},children:[e.jsx($,{className:"w-4 h-4 mr-2"}),"Delete"]})]})]})})]},s.id))})]})}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",(i.page-1)*i.perPage+1," to"," ",Math.min(i.page*i.perPage,d.count)," of"," ",d.count," results"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{variant:"outline",size:"sm",onClick:()=>u(s=>({...s,page:s.page-1})),disabled:i.page===1,children:"Previous"}),e.jsxs("span",{className:"text-sm",children:["Page ",i.page," of ",Math.ceil(d.count/i.perPage)]}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>u(s=>({...s,page:s.page+1})),disabled:i.page>=Math.ceil(d.count/i.perPage),children:"Next"})]})]})]}),e.jsx(Xe,{open:ie,onOpenChange:s=>{T(s),s||(x(!1),p(""))},children:e.jsx(Ye,{className:"w-full sm:max-w-xl overflow-hidden",children:r&&e.jsxs(e.Fragment,{children:[e.jsxs(qe,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center text-white text-xl font-medium",children:r.sender_name.split(" ").map(s=>s[0]).join("").slice(0,2).toUpperCase()}),e.jsxs("div",{className:"flex-1",children:[e.jsx(Je,{className:"text-xl",children:r.subject||"No Subject"}),e.jsx(Ke,{className:"text-base",children:r.sender_name}),e.jsx("div",{className:"flex items-center gap-2 mt-2",children:e.jsx(te,{status:r.status,type:"message"})})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 pt-2",children:[r.status!==n.REPLIED&&e.jsxs(l,{size:"sm",onClick:()=>x(!0),children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Reply"]}),e.jsxs(l,{variant:"outline",size:"sm",onClick:()=>window.open(`mailto:${r.sender_email}`),children:[e.jsx(re,{className:"w-4 h-4 mr-2"}),"Email"]}),e.jsxs(l,{variant:"destructive",size:"sm",onClick:()=>j(!0),children:[e.jsx($,{className:"w-4 h-4 mr-2"}),"Delete"]})]})]}),e.jsx(Qe,{className:"h-[calc(100vh-280px)] mt-6 pr-4",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs(_,{children:[e.jsx(R,{children:e.jsx(A,{className:"text-sm font-medium",children:"Sender Information"})}),e.jsxs(E,{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(re,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("a",{href:`mailto:${r.sender_email}`,className:"text-primary hover:underline",children:r.sender_email})]}),r.sender_phone&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(rs,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("a",{href:`tel:${r.sender_phone}`,className:"hover:underline",children:r.sender_phone})]})]})]}),e.jsxs(_,{children:[e.jsx(R,{children:e.jsx(A,{className:"text-sm font-medium",children:"Message"})}),e.jsx(E,{children:e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:r.message})})]}),xe&&e.jsxs(_,{className:"border-primary/20",children:[e.jsx(R,{children:e.jsxs(A,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(B,{className:"w-4 h-4"}),"Reply"]})}),e.jsxs(E,{className:"space-y-3",children:[e.jsx(Se,{value:y,onChange:s=>p(s.target.value),placeholder:"Type your reply...",className:"min-h-[150px]"}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(l,{variant:"outline",size:"sm",onClick:()=>{x(!1),p("")},children:"Cancel"}),e.jsxs(l,{size:"sm",onClick:je,disabled:!y.trim(),children:[e.jsx(ls,{className:"w-4 h-4 mr-2"}),"Send Reply"]})]})]})]}),e.jsxs(_,{children:[e.jsx(R,{children:e.jsx(A,{className:"text-sm font-medium",children:"Timeline"})}),e.jsxs(E,{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Received"}),e.jsx("span",{children:D(r.created_at)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Last Updated"}),e.jsx("span",{children:D(r.updated_at)})]}),r.replied_at&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Replied"}),e.jsx("span",{children:D(r.replied_at)})]})]})]})]})})]})})}),e.jsx(Pe,{open:he,onOpenChange:j,children:e.jsxs(Fe,{children:[e.jsxs(Ie,{children:[e.jsx(Ue,{children:"Delete Message"}),e.jsxs(ze,{children:["Are you sure you want to delete this message from ",r?.sender_name,"? This action cannot be undone."]})]}),e.jsxs(Oe,{children:[e.jsx(l,{variant:"outline",onClick:()=>j(!1),children:"Cancel"}),e.jsxs(l,{variant:"destructive",onClick:ge,children:[e.jsx($,{className:"w-4 h-4 mr-2"}),"Delete"]})]})]})})]})}export{$s as default};
