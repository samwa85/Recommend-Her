import{u as fe,f as Ne,r as t,j as e,B as n,a as ve,X as we,E as ye,h as Ce}from"./index-qoOME8mY.js";import{B as m}from"./badge-DS90lYj3.js";import{I as M}from"./input-COdB9PMO.js";import{T as be}from"./textarea-D1tOqvpc.js";import{t as H,T as Se,a as _e,b as se,c as x,d as Re,e as h,A as ke,f as Te,g as De}from"./table-K5LBk1_9.js";import{S as _,a as R,b as k,c as T,d as p}from"./select-D7YwqkvP.js";import{D as Pe,a as Ae,b as Ee,c as D,d as ae}from"./parseISO-Dkgfv3AF.js";import{D as qe,a as Fe,b as Oe,c as Ie,d as Ue,e as ze}from"./dialog-au1fJFZW.js";import{v as Le,w as Be,A as Me,R as He,x as Ve,h as Ge,i as P,f as Qe,y as A,k as Xe,l as $e,m as Ye,n as We,o as Je,z as N}from"./LoadingSkeleton-BIuzlw0E.js";import{C as E,a as q,b as F,d as O}from"./index-CsKqCIzL.js";import{S as Ke}from"./scroll-area-D5JBEXsZ.js";import{S as te}from"./StatusBadge-0beuKaZt.js";import{S as Ze}from"./search-BPQDrF8n.js";import{F as es}from"./funnel-UMXFXVhw.js";import{C as ss}from"./clock-DdojzwLk.js";import{F as as}from"./file-x-u3FkNXYm.js";import{E as ts,T as V}from"./trash-2-B2GZL5i8.js";import{C as re}from"./circle-check-big-BDlXIym8.js";import{C as le}from"./circle-x-CQU312bK.js";import{U as rs}from"./user-check-COeJ7n-1.js";import{B as ie}from"./building-2-LyC4uWQT.js";import{U as ls}from"./user-CEFTD0Vu.js";import{C as G}from"./circle-alert-CmZxWWpu.js";import"./tslib.es6-ByNH4KU3.js";import"./index-C7Xr5Zjk.js";import"./index-EHAx_rFm.js";import"./index-Bq8Hpwnx.js";import"./users-B7vsRM7J.js";import"./message-square-CE0bfcV6.js";import"./mail-hjAr2Bly.js";import"./shield-CPwMl-BC.js";import"./bell-B4cYDKmo.js";import"./skeleton-Br7kL-uo.js";const is=[10,25,50,100],ns=[{value:"recommendation",label:"Recommendation"},{value:"sponsorship_intro",label:"Sponsorship Intro"},{value:"talent_match",label:"Talent Match"},{value:"general",label:"General Inquiry"}],ne=u=>{switch(u){case N.URGENT:return"bg-red-100 text-red-700 border-red-200";case N.HIGH:return"bg-orange-100 text-orange-700 border-orange-200";case N.NORMAL:return"bg-blue-100 text-blue-700 border-blue-200";case N.LOW:return"bg-gray-100 text-gray-700 border-gray-200";default:return"bg-gray-100 text-gray-700"}},cs=u=>{switch(u){case N.URGENT:return e.jsx(G,{className:"w-4 h-4 text-red-500"});case N.HIGH:return e.jsx(G,{className:"w-4 h-4 text-orange-500"});default:return null}};function Ms(){fe();const[u,b]=Ne(),[ce,I]=t.useState(null),[oe,U]=t.useState(!1),[de,z]=t.useState(new Set),[L,me]=t.useState(!1),[i,Q]=t.useState({status:u.get("status")||"",search:u.get("search")||"",priority:"",request_type:"",date_from:"",date_to:""}),[B,xe]=t.useState(!1),[X,he]=t.useState({key:"created_at",direction:"desc"}),[c,v]=t.useState({page:1,perPage:25}),[pe,w]=t.useState(!1),[ue,$]=t.useState(""),{data:o,isLoading:je,error:Y,refresh:j}=Le({filters:{status:i.status||void 0,search:i.search||void 0,priority:i.priority||void 0,request_type:i.request_type||void 0},pagination:{page:c.page,perPage:c.perPage},autoRefresh:!1}),{data:r,updateStatus:W}=Be(ce),y=Object.values(i).filter(Boolean).length;de.size>0;const d=t.useCallback((s,a)=>{Q(C=>({...C,[s]:a})),v(C=>({...C,page:1}));const l=new URLSearchParams;Object.entries({...i,[s]:a}).forEach(([C,ee])=>{ee&&l.set(C,ee)}),b(l)},[i,b]),J=t.useCallback(()=>{Q({status:"",search:"",priority:"",request_type:"",date_from:"",date_to:""}),v(s=>({...s,page:1})),b(new URLSearchParams)},[b]),g=t.useCallback(s=>{he(a=>({key:s,direction:a.key===s&&a.direction==="asc"?"desc":"asc"}))},[]);t.useCallback(s=>{z(a=>{const l=new Set(a);return l.has(s)?l.delete(s):l.add(s),l})},[]),t.useCallback(()=>{z(L?new Set:new Set(o.data.map(s=>s.id))),me(!L)},[L,o.data]);const K=t.useCallback(s=>{I(s.id),$(s.admin_notes||""),U(!0)},[]),S=t.useCallback(async(s,a)=>{H.promise(async()=>{if((await W(a)).success)return j(),`Request ${a}`;throw new Error("Failed to update status")},{loading:"Updating...",success:`Request marked as ${a}`,error:"Failed to update request"})},[W,j]),ge=t.useCallback(async()=>{w(!1),U(!1),I(null),H.success("Request deleted"),j()},[j]),f=s=>X.key!==s?e.jsx(ke,{className:"w-3.5 h-3.5 text-muted-foreground/50"}):X.direction==="asc"?e.jsx(Te,{className:"w-3.5 h-3.5 text-primary"}):e.jsx(De,{className:"w-3.5 h-3.5 text-primary"}),Z=s=>{const a=s.talent,l=s.sponsor;return a?{name:a.full_name,email:a.email,type:"Talent",icon:e.jsx(ls,{className:"w-4 h-4 text-blue-500"})}:l?{name:l.full_name,email:l.email,company:l.company_name,type:"Sponsor",icon:e.jsx(ie,{className:"w-4 h-4 text-green-500"})}:{name:"Unknown",type:"Unknown",icon:e.jsx(G,{className:"w-4 h-4 text-gray-400"})}};return e.jsxs(Me,{title:"Requests",subtitle:`${o.count} total requests`,actions:e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(n,{variant:"outline",size:"sm",onClick:j,children:[e.jsx(Ce,{className:"w-4 h-4 mr-2"}),"Refresh"]})}),children:[Y&&e.jsxs("div",{className:"mb-4 p-4 rounded-lg bg-red-50 text-red-600 text-sm",children:[Y,e.jsx(n,{variant:"link",onClick:j,className:"ml-2",children:"Retry"})]}),e.jsxs("div",{className:"mb-6 space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("div",{className:"relative flex-1 min-w-[300px] max-w-md",children:[e.jsx(Ze,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(M,{placeholder:"Search requests...",value:i.search,onChange:s=>d("search",s.target.value),className:"pl-9"})]}),e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>xe(!B),className:ve(B&&"bg-muted"),children:[e.jsx(es,{className:"w-4 h-4 mr-2"}),"Filters",y>0&&e.jsx(m,{variant:"secondary",className:"ml-2",children:y})]}),e.jsx("div",{className:"flex-1"}),e.jsxs(_,{value:c.perPage.toString(),onValueChange:s=>v(a=>({...a,perPage:parseInt(s),page:1})),children:[e.jsx(R,{className:"w-[100px]",children:e.jsx(k,{})}),e.jsx(T,{children:is.map(s=>e.jsxs(p,{value:s.toString(),children:[s," / page"]},s))})]})]}),B&&e.jsxs("div",{className:"p-4 bg-muted/50 rounded-lg space-y-3",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs(_,{value:i.status,onValueChange:s=>d("status",s),children:[e.jsx(R,{className:"w-[160px]",children:e.jsx(k,{placeholder:"Status"})}),e.jsxs(T,{children:[e.jsx(p,{value:"",children:"All Status"}),Object.entries(He).map(([s,a])=>e.jsx(p,{value:s,children:a},s))]})]}),e.jsxs(_,{value:i.priority,onValueChange:s=>d("priority",s),children:[e.jsx(R,{className:"w-[160px]",children:e.jsx(k,{placeholder:"Priority"})}),e.jsxs(T,{children:[e.jsx(p,{value:"",children:"All Priorities"}),Object.entries(Ve).map(([s,a])=>e.jsx(p,{value:s,children:a},s))]})]}),e.jsxs(_,{value:i.request_type,onValueChange:s=>d("request_type",s),children:[e.jsx(R,{className:"w-[180px]",children:e.jsx(k,{placeholder:"Request Type"})}),e.jsxs(T,{children:[e.jsx(p,{value:"",children:"All Types"}),ns.map(s=>e.jsx(p,{value:s.value,children:s.label},s.value))]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ss,{className:"w-4 h-4 text-muted-foreground"}),e.jsx(M,{type:"date",placeholder:"From",value:i.date_from,onChange:s=>d("date_from",s.target.value),className:"w-[140px]"}),e.jsx("span",{className:"text-muted-foreground",children:"to"}),e.jsx(M,{type:"date",placeholder:"To",value:i.date_to,onChange:s=>d("date_to",s.target.value),className:"w-[140px]"})]}),e.jsx(n,{variant:"ghost",size:"sm",onClick:J,children:"Clear Filters"})]})]}),y>0&&e.jsx("div",{className:"flex flex-wrap items-center gap-2",children:Object.entries(i).filter(([s,a])=>a).map(([s,a])=>e.jsxs(m,{variant:"secondary",className:"gap-1 pr-1 cursor-pointer hover:bg-secondary/80",onClick:()=>d(s,""),children:[s,": ",a,e.jsx(we,{className:"w-3 h-3 ml-1"})]},s))})]}),je?e.jsx(Ge,{columns:7,rows:5}):o.data.length===0?e.jsxs("div",{className:"text-center py-16",children:[e.jsx(as,{className:"w-16 h-16 text-muted-foreground/50 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium",children:"No requests found"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:y>0?"Try adjusting your filters":"No requests have been submitted yet"}),y>0&&e.jsx(n,{variant:"outline",className:"mt-4",onClick:J,children:"Clear Filters"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"rounded-md border",children:e.jsxs(Se,{children:[e.jsx(_e,{children:e.jsxs(se,{className:"bg-muted/50 hover:bg-muted/50",children:[e.jsx(x,{className:"cursor-pointer",onClick:()=>g("request_type"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["Type",f("request_type")]})}),e.jsx(x,{className:"cursor-pointer",onClick:()=>g("requester"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["Requester",f("requester")]})}),e.jsx(x,{className:"cursor-pointer",onClick:()=>g("description"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["Description",f("description")]})}),e.jsx(x,{className:"cursor-pointer",onClick:()=>g("priority"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["Priority",f("priority")]})}),e.jsx(x,{className:"cursor-pointer",onClick:()=>g("status"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["Status",f("status")]})}),e.jsx(x,{className:"cursor-pointer",onClick:()=>g("created_at"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["Submitted",f("created_at")]})}),e.jsx(x,{className:"w-10"})]})}),e.jsx(Re,{children:o.data.map(s=>{const a=Z(s);return e.jsxs(se,{className:"group cursor-pointer",onClick:()=>K(s),children:[e.jsx(h,{children:e.jsx(m,{variant:"outline",className:"capitalize",children:s.request_type.replace("_"," ")})}),e.jsx(h,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[a.icon,e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:a.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:a.type})]})]})}),e.jsx(h,{children:e.jsx("span",{className:"text-sm text-muted-foreground line-clamp-1 max-w-[250px]",children:s.description})}),e.jsx(h,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[cs(s.priority||""),e.jsx(m,{variant:"outline",className:ne(s.priority||""),children:s.priority||"Normal"})]})}),e.jsx(h,{children:e.jsx(te,{status:s.status,type:"request"})}),e.jsxs(h,{children:[e.jsx("div",{className:"text-sm",children:P(s.created_at)}),e.jsx("div",{className:"text-xs text-muted-foreground",children:Qe(s.created_at)})]}),e.jsx(h,{onClick:l=>l.stopPropagation(),children:e.jsxs(Pe,{children:[e.jsx(Ae,{asChild:!0,children:e.jsx(n,{variant:"ghost",size:"icon",className:"h-8 w-8 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(ts,{className:"w-4 h-4"})})}),e.jsxs(Ee,{align:"end",children:[e.jsxs(D,{onClick:()=>K(s),children:[e.jsx(ye,{className:"w-4 h-4 mr-2"}),"View Details"]}),e.jsx(ae,{}),s.status!=="approved"&&s.status!=="closed"&&e.jsxs(D,{onClick:()=>S(s,A.APPROVED),children:[e.jsx(re,{className:"w-4 h-4 mr-2"}),"Approve"]}),s.status!=="closed"&&e.jsxs(D,{onClick:()=>S(s,A.CLOSED),children:[e.jsx(le,{className:"w-4 h-4 mr-2"}),"Close"]}),e.jsx(ae,{}),e.jsxs(D,{className:"text-red-600",onClick:()=>{I(s.id),w(!0)},children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"Delete"]})]})]})})]},s.id)})})]})}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",(c.page-1)*c.perPage+1," to"," ",Math.min(c.page*c.perPage,o.count)," of"," ",o.count," results"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(n,{variant:"outline",size:"sm",onClick:()=>v(s=>({...s,page:s.page-1})),disabled:c.page===1,children:"Previous"}),e.jsxs("span",{className:"text-sm",children:["Page ",c.page," of ",Math.ceil(o.count/c.perPage)]}),e.jsx(n,{variant:"outline",size:"sm",onClick:()=>v(s=>({...s,page:s.page+1})),disabled:c.page>=Math.ceil(o.count/c.perPage),children:"Next"})]})]})]}),e.jsx(Xe,{open:oe,onOpenChange:U,children:e.jsx($e,{className:"w-full sm:max-w-xl overflow-hidden",children:r&&e.jsxs(e.Fragment,{children:[e.jsxs(Ye,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-gradient-to-br from-green-500 to-teal-500 flex items-center justify-center text-white text-xl font-medium",children:e.jsx(rs,{className:"w-8 h-8"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx(We,{className:"text-xl",children:"Request Details"}),e.jsx(Je,{className:"text-base capitalize",children:r.request_type.replace("_"," ")}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(te,{status:r.status,type:"request"}),e.jsxs(m,{variant:"outline",className:ne(r.priority||""),children:[r.priority||"Normal"," Priority"]})]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 pt-2",children:[r.status!=="approved"&&r.status!=="closed"&&e.jsxs(n,{size:"sm",onClick:()=>S(r,A.APPROVED),children:[e.jsx(re,{className:"w-4 h-4 mr-2"}),"Approve"]}),r.status!=="closed"&&e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>S(r,A.CLOSED),children:[e.jsx(le,{className:"w-4 h-4 mr-2"}),"Close"]}),e.jsxs(n,{variant:"destructive",size:"sm",onClick:()=>w(!0),children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"Delete"]})]})]}),e.jsx(Ke,{className:"h-[calc(100vh-280px)] mt-6 pr-4",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs(E,{children:[e.jsx(q,{children:e.jsx(F,{className:"text-sm font-medium",children:"Requester Information"})}),e.jsx(O,{className:"space-y-3",children:(()=>{const s=Z(r);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[s.icon,e.jsx("span",{className:"font-medium",children:s.name}),e.jsx(m,{variant:"outline",children:s.type})]}),s.email&&e.jsx("div",{className:"flex items-center gap-2 pl-6",children:e.jsx("span",{className:"text-sm text-muted-foreground",children:s.email})}),s.company&&e.jsxs("div",{className:"flex items-center gap-2 pl-6",children:[e.jsx(ie,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:s.company})]})]})})()})]}),e.jsxs(E,{children:[e.jsx(q,{children:e.jsx(F,{className:"text-sm font-medium",children:"Request Details"})}),e.jsxs(O,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Type"}),e.jsx(m,{variant:"outline",className:"capitalize",children:r.request_type.replace("_"," ")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Description"}),e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:r.description})]})]})]}),e.jsxs(E,{children:[e.jsx(q,{children:e.jsx(F,{className:"text-sm font-medium",children:"Admin Notes"})}),e.jsxs(O,{className:"space-y-3",children:[e.jsx(be,{value:ue,onChange:s=>$(s.target.value),placeholder:"Add notes about this request...",className:"min-h-[100px]"}),e.jsx(n,{size:"sm",variant:"outline",onClick:()=>{H.success("Notes saved")},children:"Save Notes"})]})]}),e.jsxs(E,{children:[e.jsx(q,{children:e.jsx(F,{className:"text-sm font-medium",children:"Timeline"})}),e.jsxs(O,{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Submitted"}),e.jsx("span",{children:P(r.created_at)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Last Updated"}),e.jsx("span",{children:P(r.updated_at)})]}),r.resolved_at&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Resolved"}),e.jsx("span",{children:P(r.resolved_at)})]})]})]})]})})]})})}),e.jsx(qe,{open:pe,onOpenChange:w,children:e.jsxs(Fe,{children:[e.jsxs(Oe,{children:[e.jsx(Ie,{children:"Delete Request"}),e.jsx(Ue,{children:"Are you sure you want to delete this request? This action cannot be undone."})]}),e.jsxs(ze,{children:[e.jsx(n,{variant:"outline",onClick:()=>w(!1),children:"Cancel"}),e.jsxs(n,{variant:"destructive",onClick:ge,children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"Delete"]})]})]})})]})}export{Ms as default};
