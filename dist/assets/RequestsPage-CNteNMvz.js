import{l as je,r,t as L,j as e,B as n,a as ge,X as fe,E as Ne,m as ve}from"./index-DFWiVR3s.js";import{B as m}from"./badge-CHNks9Gx.js";import{I as M}from"./input-BRfSl6Ko.js";import{T as ye}from"./textarea-Dqr-7fh_.js";import{S as _,a as R,b as k,c as T,d as x}from"./select-CZ5lG6Ed.js";import{T as we,a as Ce,b as Z,c as p,d as be,e as h}from"./table-B3szQ2mI.js";import{D as Se,a as _e,b as Re,c as D,d as ee}from"./dropdown-menu-BOXuGTFg.js";import{D as ke,a as Te,b as De,c as Pe,d as qe,e as Ee}from"./dialog-mWvL8XvD.js";import{s as Ae,t as Fe,A as Oe,R as Ie,v as Ue,g as P,f as ze,w as q,S as Le,i as Me,j as Be,k as He,l as Ve,x as N}from"./AdminLayout-BZSyr1bk.js";import{C as E,a as A,b as F,d as O}from"./card-DMwxKRzs.js";import{S as Ge}from"./scroll-area-B1r1DZE5.js";import{a as Qe}from"./LoadingSkeleton-C89YAwry.js";import{S as se}from"./StatusBadge-B30NJS-F.js";import{S as Xe}from"./search-B2QVa34Y.js";import{F as $e}from"./funnel-CGF_XATx.js";import{C as Ye}from"./clock-iKpkAaQ6.js";import{F as We}from"./file-x-D56Ffx2d.js";import{E as Je,T as B}from"./trash-2-C9rU121_.js";import{C as ae}from"./circle-check-big-i2QELpmb.js";import{C as te}from"./circle-x-DW2K9umr.js";import{U as Ke}from"./user-check-CA-8ar5P.js";import{B as re}from"./building-2-De9H6TkV.js";import{A as Ze,a as es,b as ss}from"./arrow-up-WCOh9daP.js";import{U as as}from"./user-BbxCiuRz.js";import{C as H}from"./circle-alert-BZZZJy-E.js";import"./index-Cl4iP5m9.js";import"./index-CWO8BEd0.js";import"./index-CAsnp8AP.js";import"./tslib.es6-eMSY344_.js";import"./index-DJ6pmmvH.js";import"./index-DVAE1cjs.js";import"./chevron-down-CnxfN6eY.js";import"./index-DmaXBg08.js";import"./client-CrqYG681.js";import"./errors-B3_eVdCY.js";import"./users-DCngZZIb.js";import"./file-text-BQI-XE8w.js";import"./message-square-Bcw3mLo6.js";import"./mail-zjxhTzbQ.js";import"./shield-CSwj9smG.js";import"./bell-FNheItAI.js";import"./skeleton-CoFZ2UGj.js";const ts=[10,25,50,100],rs=[{value:"recommendation",label:"Recommendation"},{value:"sponsorship_intro",label:"Sponsorship Intro"},{value:"talent_match",label:"Talent Match"},{value:"general",label:"General Inquiry"}],le=u=>{switch(u){case N.URGENT:return"bg-red-100 text-red-700 border-red-200";case N.HIGH:return"bg-orange-100 text-orange-700 border-orange-200";case N.NORMAL:return"bg-blue-100 text-blue-700 border-blue-200";case N.LOW:return"bg-gray-100 text-gray-700 border-gray-200";default:return"bg-gray-100 text-gray-700"}},ls=u=>{switch(u){case N.URGENT:return e.jsx(H,{className:"w-4 h-4 text-red-500"});case N.HIGH:return e.jsx(H,{className:"w-4 h-4 text-orange-500"});default:return null}};function $s(){const[u,b]=je(),[ie,I]=r.useState(null),[ne,U]=r.useState(!1),[t,V]=r.useState({status:u.get("status")||"",search:u.get("search")||"",priority:"",request_type:"",date_from:"",date_to:""}),[z,ce]=r.useState(!1),[G,oe]=r.useState({key:"created_at",direction:"desc"}),[i,v]=r.useState({page:1,perPage:25}),[de,y]=r.useState(!1),[me,Q]=r.useState(""),xe=r.useMemo(()=>({status:t.status||void 0,search:t.search||void 0,priority:t.priority||void 0,request_type:t.request_type||void 0}),[t.status,t.search,t.priority,t.request_type]),pe=r.useMemo(()=>({page:i.page,perPage:i.perPage}),[i.page,i.perPage]),{data:o,isLoading:he,error:X,refresh:j}=Ae({filters:xe,pagination:pe,autoRefresh:!1}),{data:l,updateStatus:$}=Fe(ie),w=Object.values(t).filter(Boolean).length,d=r.useCallback((s,a)=>{V(C=>({...C,[s]:a})),v(C=>({...C,page:1}));const c=new URLSearchParams;Object.entries({...t,[s]:a}).forEach(([C,K])=>{K&&c.set(C,K)}),b(c)},[t,b]),Y=r.useCallback(()=>{V({status:"",search:"",priority:"",request_type:"",date_from:"",date_to:""}),v(s=>({...s,page:1})),b(new URLSearchParams)},[b]),g=r.useCallback(s=>{oe(a=>({key:s,direction:a.key===s&&a.direction==="asc"?"desc":"asc"}))},[]),W=r.useCallback(s=>{I(s.id),Q(s.admin_notes||""),U(!0)},[]),S=r.useCallback(async s=>{L.promise(async()=>{if((await $(s)).success)return j(),`Request ${s}`;throw new Error("Failed to update status")},{loading:"Updating...",success:`Request marked as ${s}`,error:"Failed to update request"})},[$,j]),ue=r.useCallback(async()=>{y(!1),U(!1),I(null),L.success("Request deleted"),j()},[j]),f=s=>G.key!==s?e.jsx(Ze,{className:"w-3.5 h-3.5 text-muted-foreground/50"}):G.direction==="asc"?e.jsx(es,{className:"w-3.5 h-3.5 text-primary"}):e.jsx(ss,{className:"w-3.5 h-3.5 text-primary"}),J=s=>{const a=s.talent,c=s.sponsor;return a?{name:a.full_name,email:a.email,type:"Talent",icon:e.jsx(as,{className:"w-4 h-4 text-blue-500"})}:c?{name:c.full_name,email:c.email,company:c.company_name,type:"Sponsor",icon:e.jsx(re,{className:"w-4 h-4 text-green-500"})}:{name:"Unknown",type:"Unknown",icon:e.jsx(H,{className:"w-4 h-4 text-gray-400"})}};return e.jsxs(Oe,{title:"Requests",subtitle:`${o.count} total requests`,actions:e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(n,{variant:"outline",size:"sm",onClick:j,children:[e.jsx(ve,{className:"w-4 h-4 mr-2"}),"Refresh"]})}),children:[X&&e.jsxs("div",{className:"mb-4 p-4 rounded-lg bg-red-50 text-red-600 text-sm",children:[X,e.jsx(n,{variant:"link",onClick:j,className:"ml-2",children:"Retry"})]}),e.jsxs("div",{className:"mb-6 space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("div",{className:"relative flex-1 min-w-[300px] max-w-md",children:[e.jsx(Xe,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(M,{placeholder:"Search requests...",value:t.search,onChange:s=>d("search",s.target.value),className:"pl-9"})]}),e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>ce(!z),className:ge(z&&"bg-muted"),children:[e.jsx($e,{className:"w-4 h-4 mr-2"}),"Filters",w>0&&e.jsx(m,{variant:"secondary",className:"ml-2",children:w})]}),e.jsx("div",{className:"flex-1"}),e.jsxs(_,{value:i.perPage.toString(),onValueChange:s=>v(a=>({...a,perPage:parseInt(s),page:1})),children:[e.jsx(R,{className:"w-[100px]",children:e.jsx(k,{})}),e.jsx(T,{children:ts.map(s=>e.jsxs(x,{value:s.toString(),children:[s," / page"]},s))})]})]}),z&&e.jsxs("div",{className:"p-4 bg-muted/50 rounded-lg space-y-3",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs(_,{value:t.status||"all",onValueChange:s=>d("status",s==="all"?"":s),children:[e.jsx(R,{className:"w-[160px]",children:e.jsx(k,{placeholder:"Status"})}),e.jsxs(T,{children:[e.jsx(x,{value:"all",children:"All Status"}),Object.entries(Ie).map(([s,a])=>e.jsx(x,{value:s,children:a},s))]})]}),e.jsxs(_,{value:t.priority||"all",onValueChange:s=>d("priority",s==="all"?"":s),children:[e.jsx(R,{className:"w-[160px]",children:e.jsx(k,{placeholder:"Priority"})}),e.jsxs(T,{children:[e.jsx(x,{value:"all",children:"All Priorities"}),Object.entries(Ue).map(([s,a])=>e.jsx(x,{value:s,children:a},s))]})]}),e.jsxs(_,{value:t.request_type||"all",onValueChange:s=>d("request_type",s==="all"?"":s),children:[e.jsx(R,{className:"w-[180px]",children:e.jsx(k,{placeholder:"Request Type"})}),e.jsxs(T,{children:[e.jsx(x,{value:"all",children:"All Types"}),rs.map(s=>e.jsx(x,{value:s.value,children:s.label},s.value))]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ye,{className:"w-4 h-4 text-muted-foreground"}),e.jsx(M,{type:"date",placeholder:"From",value:t.date_from,onChange:s=>d("date_from",s.target.value),className:"w-[140px]"}),e.jsx("span",{className:"text-muted-foreground",children:"to"}),e.jsx(M,{type:"date",placeholder:"To",value:t.date_to,onChange:s=>d("date_to",s.target.value),className:"w-[140px]"})]}),e.jsx(n,{variant:"ghost",size:"sm",onClick:Y,children:"Clear Filters"})]})]}),w>0&&e.jsx("div",{className:"flex flex-wrap items-center gap-2",children:Object.entries(t).filter(([,s])=>s).map(([s,a])=>e.jsxs(m,{variant:"secondary",className:"gap-1 pr-1 cursor-pointer hover:bg-secondary/80",onClick:()=>d(s,""),children:[s,": ",a,e.jsx(fe,{className:"w-3 h-3 ml-1"})]},s))})]}),he?e.jsx(Qe,{columns:7,rows:5}):o.data.length===0?e.jsxs("div",{className:"text-center py-16",children:[e.jsx(We,{className:"w-16 h-16 text-muted-foreground/50 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium",children:"No requests found"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:w>0?"Try adjusting your filters":"No requests have been submitted yet"}),w>0&&e.jsx(n,{variant:"outline",className:"mt-4",onClick:Y,children:"Clear Filters"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"rounded-md border",children:e.jsxs(we,{children:[e.jsx(Ce,{children:e.jsxs(Z,{className:"bg-muted/50 hover:bg-muted/50",children:[e.jsx(p,{className:"cursor-pointer",onClick:()=>g("request_type"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["Type",f("request_type")]})}),e.jsx(p,{className:"cursor-pointer",onClick:()=>g("requester"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["Requester",f("requester")]})}),e.jsx(p,{className:"cursor-pointer",onClick:()=>g("description"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["Description",f("description")]})}),e.jsx(p,{className:"cursor-pointer",onClick:()=>g("priority"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["Priority",f("priority")]})}),e.jsx(p,{className:"cursor-pointer",onClick:()=>g("status"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["Status",f("status")]})}),e.jsx(p,{className:"cursor-pointer",onClick:()=>g("created_at"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["Submitted",f("created_at")]})}),e.jsx(p,{className:"w-10"})]})}),e.jsx(be,{children:o.data.map(s=>{const a=J(s);return e.jsxs(Z,{className:"group cursor-pointer",onClick:()=>W(s),children:[e.jsx(h,{children:e.jsx(m,{variant:"outline",className:"capitalize",children:s.request_type.replace("_"," ")})}),e.jsx(h,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[a.icon,e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:a.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:a.type})]})]})}),e.jsx(h,{children:e.jsx("span",{className:"text-sm text-muted-foreground line-clamp-1 max-w-[250px]",children:s.description})}),e.jsx(h,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[ls(s.priority||""),e.jsx(m,{variant:"outline",className:le(s.priority||""),children:s.priority||"Normal"})]})}),e.jsx(h,{children:e.jsx(se,{status:s.status,type:"request"})}),e.jsxs(h,{children:[e.jsx("div",{className:"text-sm",children:P(s.created_at)}),e.jsx("div",{className:"text-xs text-muted-foreground",children:ze(s.created_at)})]}),e.jsx(h,{onClick:c=>c.stopPropagation(),children:e.jsxs(Se,{children:[e.jsx(_e,{asChild:!0,children:e.jsx(n,{variant:"ghost",size:"icon",className:"h-8 w-8 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(Je,{className:"w-4 h-4"})})}),e.jsxs(Re,{align:"end",children:[e.jsxs(D,{onClick:()=>W(s),children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"View Details"]}),e.jsx(ee,{}),s.status!=="approved"&&s.status!=="closed"&&e.jsxs(D,{onClick:()=>S(q.APPROVED),children:[e.jsx(ae,{className:"w-4 h-4 mr-2"}),"Approve"]}),s.status!=="closed"&&e.jsxs(D,{onClick:()=>S(q.CLOSED),children:[e.jsx(te,{className:"w-4 h-4 mr-2"}),"Close"]}),e.jsx(ee,{}),e.jsxs(D,{className:"text-red-600",onClick:()=>{I(s.id),y(!0)},children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Delete"]})]})]})})]},s.id)})})]})}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",(i.page-1)*i.perPage+1," to"," ",Math.min(i.page*i.perPage,o.count)," of"," ",o.count," results"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(n,{variant:"outline",size:"sm",onClick:()=>v(s=>({...s,page:s.page-1})),disabled:i.page===1,children:"Previous"}),e.jsxs("span",{className:"text-sm",children:["Page ",i.page," of ",Math.ceil(o.count/i.perPage)]}),e.jsx(n,{variant:"outline",size:"sm",onClick:()=>v(s=>({...s,page:s.page+1})),disabled:i.page>=Math.ceil(o.count/i.perPage),children:"Next"})]})]})]}),e.jsx(Le,{open:ne,onOpenChange:U,children:e.jsx(Me,{className:"w-full sm:max-w-xl overflow-hidden",children:l&&e.jsxs(e.Fragment,{children:[e.jsxs(Be,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-gradient-to-br from-green-500 to-teal-500 flex items-center justify-center text-white text-xl font-medium",children:e.jsx(Ke,{className:"w-8 h-8"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx(He,{className:"text-xl",children:"Request Details"}),e.jsx(Ve,{className:"text-base capitalize",children:l.request_type.replace("_"," ")}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(se,{status:l.status,type:"request"}),e.jsxs(m,{variant:"outline",className:le(l.priority||""),children:[l.priority||"Normal"," Priority"]})]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 pt-2",children:[l.status!=="approved"&&l.status!=="closed"&&e.jsxs(n,{size:"sm",onClick:()=>S(q.APPROVED),children:[e.jsx(ae,{className:"w-4 h-4 mr-2"}),"Approve"]}),l.status!=="closed"&&e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>S(q.CLOSED),children:[e.jsx(te,{className:"w-4 h-4 mr-2"}),"Close"]}),e.jsxs(n,{variant:"destructive",size:"sm",onClick:()=>y(!0),children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Delete"]})]})]}),e.jsx(Ge,{className:"h-[calc(100vh-280px)] mt-6 pr-4",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs(E,{children:[e.jsx(A,{children:e.jsx(F,{className:"text-sm font-medium",children:"Requester Information"})}),e.jsx(O,{className:"space-y-3",children:(()=>{const s=J(l);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[s.icon,e.jsx("span",{className:"font-medium",children:s.name}),e.jsx(m,{variant:"outline",children:s.type})]}),s.email&&e.jsx("div",{className:"flex items-center gap-2 pl-6",children:e.jsx("span",{className:"text-sm text-muted-foreground",children:s.email})}),s.company&&e.jsxs("div",{className:"flex items-center gap-2 pl-6",children:[e.jsx(re,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:s.company})]})]})})()})]}),e.jsxs(E,{children:[e.jsx(A,{children:e.jsx(F,{className:"text-sm font-medium",children:"Request Details"})}),e.jsxs(O,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Type"}),e.jsx(m,{variant:"outline",className:"capitalize",children:l.request_type.replace("_"," ")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Description"}),e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:l.description})]})]})]}),e.jsxs(E,{children:[e.jsx(A,{children:e.jsx(F,{className:"text-sm font-medium",children:"Admin Notes"})}),e.jsxs(O,{className:"space-y-3",children:[e.jsx(ye,{value:me,onChange:s=>Q(s.target.value),placeholder:"Add notes about this request...",className:"min-h-[100px]"}),e.jsx(n,{size:"sm",variant:"outline",onClick:()=>{L.success("Notes saved")},children:"Save Notes"})]})]}),e.jsxs(E,{children:[e.jsx(A,{children:e.jsx(F,{className:"text-sm font-medium",children:"Timeline"})}),e.jsxs(O,{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Submitted"}),e.jsx("span",{children:P(l.created_at)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Last Updated"}),e.jsx("span",{children:P(l.updated_at)})]}),l.resolved_at&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Resolved"}),e.jsx("span",{children:P(l.resolved_at)})]})]})]})]})})]})})}),e.jsx(ke,{open:de,onOpenChange:y,children:e.jsxs(Te,{children:[e.jsxs(De,{children:[e.jsx(Pe,{children:"Delete Request"}),e.jsx(qe,{children:"Are you sure you want to delete this request? This action cannot be undone."})]}),e.jsxs(Ee,{children:[e.jsx(n,{variant:"outline",onClick:()=>y(!1),children:"Cancel"}),e.jsxs(n,{variant:"destructive",onClick:ue,children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Delete"]})]})]})})]})}export{$s as default};
