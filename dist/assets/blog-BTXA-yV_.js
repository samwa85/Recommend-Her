import{d as n,u as y}from"./client-Anx0SkdC.js";import{a as m,h as u}from"./errors-B3_eVdCY.js";async function b(e={}){const{filters:r={},pagination:o={}}=e,s=o.page??1,l=o.perPage??10;try{let t=n.from("blog_posts").select("*",{count:"exact"});r.status&&(t=t.eq("status",r.status)),r.category&&(t=t.eq("category",r.category)),r.author&&(t=t.eq("author_name",r.author)),r.tag&&(t=t.contains("tags",[r.tag])),r.search&&(t=t.or(`title.ilike.%${r.search}%,excerpt.ilike.%${r.search}%,content.ilike.%${r.search}%`)),r.status==="published"?t=t.order("published_at",{ascending:!1}):t=t.order("created_at",{ascending:!1});const a=(s-1)*l,c=a+l-1;t=t.range(a,c);const{data:d,error:i,count:f}=await t;if(i)throw console.error("[Blog] listBlogPosts database error:",i),i;return{data:d||[],count:f||0,page:s,perPage:l,totalPages:Math.ceil((f||0)/l),error:null}}catch(t){let a;if(t instanceof Error)a=t.message;else if(typeof t=="object"&&t!==null){const c=t;a=c.message||c.error||JSON.stringify(t)}else a=String(t);return{data:[],count:0,page:s,perPage:l,totalPages:0,error:new Error(a)}}}async function B(e={}){try{let r=n.from("blog_posts").select("*").eq("status","published").order("published_at",{ascending:!1});e.category&&(r=r.eq("category",e.category)),e.limit&&(r=r.limit(e.limit));const{data:o,error:s}=await r;if(s)throw s;return{data:o||[],count:o?.length||0,error:null}}catch(r){return m(r)}}async function P(e){try{const{data:r,error:o}=await n.from("blog_posts").select("*").eq("slug",e).single();if(o)throw o;return{data:r,error:null}}catch(r){return u(r)}}async function _(e){try{e.slug||(e.slug=h(e.title)),console.log("[Blog] Creating post:",{title:e.title,slug:e.slug,status:e.status});const{data:r,error:o}=await n.from("blog_posts").insert(e).select().single();if(o)throw console.error("[Blog] Create error:",o),o;return console.log("[Blog] Post created:",r?.id),{data:r,error:null}}catch(r){return console.error("[Blog] Create exception:",r),u(r)}}async function g(e,r){try{r.title&&!r.slug&&(r.slug=h(r.title));const{data:o,error:s}=await n.from("blog_posts").update(r).eq("id",e).select().single();if(s)throw s;return{data:o,error:null}}catch(o){return u(o)}}async function q(e){return g(e,{status:"published"})}async function S(e){return g(e,{status:"draft"})}async function E(e){return g(e,{status:"archived"})}async function C(e){try{const{error:r}=await n.from("blog_posts").delete().eq("id",e);if(r)throw r;return{success:!0,error:null}}catch(r){return{success:!1,error:r instanceof Error?r:new Error(String(r))}}}async function M(e){try{const r=await y("blog-images",e);if(r.error)throw r.error;return{url:r.url,error:null}}catch(r){return{url:null,error:r instanceof Error?r:new Error(String(r))}}}function h(e){return e.toLowerCase().replace(/[^\w\s-]/g,"").replace(/\s+/g,"-").substring(0,100)}function x(e){const o=e.trim().split(/\s+/).length;return`${Math.ceil(o/200)} min read`}async function $(){try{const{data:e,error:r}=await n.from("blog_posts").select("category");if(r)throw r;return[...new Set((e||[]).map(s=>s.category))]}catch{return["Leadership","Success Stories","Diversity & Inclusion","Career Growth"]}}export{$ as a,P as b,h as c,x as d,g as e,_ as f,B as g,C as h,E as i,S as j,b as l,q as p,M as u};
