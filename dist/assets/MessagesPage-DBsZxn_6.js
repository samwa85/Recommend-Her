import{c as ne,l as Ne,r,t as I,j as e,B as l,a as K,X as ve,E as we,m as ye}from"./index-DFWiVR3s.js";import{B as Q}from"./badge-CHNks9Gx.js";import{I as U}from"./input-BRfSl6Ko.js";import{T as Ce}from"./textarea-Dqr-7fh_.js";import{S as W,a as Z,b as ee,c as se,d as z}from"./select-CZ5lG6Ed.js";import{T as be,a as Se,b as ae,c as N,d as ke,e as v}from"./table-B3szQ2mI.js";import{D as _e,a as De,b as Re,c as w,d as Me}from"./dropdown-menu-BOXuGTFg.js";import{D as Ee,a as Te,b as Ae,c as Pe,d as Fe,e as Ie}from"./dialog-mWvL8XvD.js";import{y as Ue,z as ze,M as c,A as Oe,B as $e,g as y,f as Be,S as Le,i as He,j as Ve,k as Ge,l as Ye}from"./AdminLayout-BZSyr1bk.js";import{C,a as b,b as S,d as k}from"./card-DMwxKRzs.js";import{S as Xe}from"./scroll-area-B1r1DZE5.js";import{a as qe}from"./LoadingSkeleton-C89YAwry.js";import{S as te}from"./StatusBadge-B30NJS-F.js";import{S as Je}from"./search-B2QVa34Y.js";import{F as Ke}from"./funnel-CGF_XATx.js";import{C as Qe}from"./clock-iKpkAaQ6.js";import{E as We,T as O}from"./trash-2-C9rU121_.js";import{C as re}from"./circle-check-big-i2QELpmb.js";import{A as Ze}from"./archive-7cSUAsXV.js";import{M as le}from"./mail-zjxhTzbQ.js";import{P as es}from"./phone-GF4CrC5D.js";import{S as ss}from"./send-D_1UsJRH.js";import{A as as,a as ts,b as rs}from"./arrow-up-WCOh9daP.js";import"./index-Cl4iP5m9.js";import"./index-CWO8BEd0.js";import"./index-CAsnp8AP.js";import"./tslib.es6-eMSY344_.js";import"./index-DJ6pmmvH.js";import"./index-DVAE1cjs.js";import"./chevron-down-CnxfN6eY.js";import"./index-DmaXBg08.js";import"./client-CrqYG681.js";import"./errors-B3_eVdCY.js";import"./users-DCngZZIb.js";import"./building-2-De9H6TkV.js";import"./file-text-BQI-XE8w.js";import"./message-square-Bcw3mLo6.js";import"./shield-CSwj9smG.js";import"./bell-FNheItAI.js";import"./skeleton-CoFZ2UGj.js";const ls=[["polyline",{points:"22 12 16 12 14 15 10 15 8 12 2 12",key:"o97t9d"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}]],ns=ne("inbox",ls);const is=[["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}],["path",{d:"m9 17-5-5 5-5",key:"nvlc11"}]],$=ne("reply",is),cs=[10,25,50,100];function Js(){const[B,_]=Ne(),[ie,E]=r.useState(null),[ce,T]=r.useState(!1),[i,L]=r.useState({status:B.get("status")||"",search:B.get("search")||"",date_from:"",date_to:""}),[A,de]=r.useState(!1),[H,oe]=r.useState({key:"created_at",direction:"desc"}),[n,x]=r.useState({page:1,perPage:25}),[h,p]=r.useState(""),[me,m]=r.useState(!1),[xe,u]=r.useState(!1),he=r.useMemo(()=>({status:i.status||void 0,search:i.search||void 0}),[i.status,i.search]),pe=r.useMemo(()=>({page:n.page,perPage:n.perPage}),[n.page,n.perPage]),{data:o,isLoading:ue,error:V,refresh:d}=Ue({filters:he,pagination:pe,autoRefresh:!0}),{data:a,replies:P,updateStatus:D,addReply:G}=ze(ie),j=Object.values(i).filter(Boolean).length,je=o.data.filter(s=>s.status===c.UNREAD).length,g=r.useCallback((s,t)=>{L(f=>({...f,[s]:t})),x(f=>({...f,page:1}));const q=new URLSearchParams;Object.entries({...i,[s]:t}).forEach(([f,J])=>{J&&q.set(f,J)}),_(q)},[i,_]),Y=r.useCallback(()=>{L({status:"",search:"",date_from:"",date_to:""}),x(s=>({...s,page:1})),_(new URLSearchParams)},[_]),R=r.useCallback(s=>{oe(t=>({key:s,direction:t.key===s&&t.direction==="asc"?"desc":"asc"}))},[]),F=r.useCallback(async s=>{E(s.id),m(!1),p(""),s.status===c.UNREAD&&(await D(c.READ),d()),T(!0)},[D,d]),X=r.useCallback(async s=>{I.promise(async()=>{if((await D(s)).success)return d(),`Message ${s}`;throw new Error("Failed to update status")},{loading:"Updating...",success:`Message marked as ${s}`,error:"Failed to update message"})},[D,d]),ge=r.useCallback(async()=>{h.trim()&&I.promise(async()=>{const s=await G(h.trim());if(!s.success)throw s.error;return m(!1),p(""),d(),"Reply saved"},{loading:"Saving reply...",success:"Reply saved successfully",error:s=>`Failed to save reply: ${s instanceof Error?s.message:"Unknown error"}`})},[h,G,d]),fe=r.useCallback(async()=>{u(!1),T(!1),E(null),I.success("Message deleted"),d()},[d]),M=s=>H.key!==s?e.jsx(as,{className:"w-3.5 h-3.5 text-muted-foreground/50"}):H.direction==="asc"?e.jsx(ts,{className:"w-3.5 h-3.5 text-primary"}):e.jsx(rs,{className:"w-3.5 h-3.5 text-primary"});return e.jsxs(Oe,{title:"Messages",subtitle:`${o.count} total messages â€¢ ${je} unread`,actions:e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(l,{variant:"outline",size:"sm",onClick:d,children:[e.jsx(ye,{className:"w-4 h-4 mr-2"}),"Refresh"]})}),children:[V&&e.jsxs("div",{className:"mb-4 p-4 rounded-lg bg-red-50 text-red-600 text-sm",children:[V,e.jsx(l,{variant:"link",onClick:d,className:"ml-2",children:"Retry"})]}),e.jsxs("div",{className:"mb-6 space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("div",{className:"relative flex-1 min-w-[300px] max-w-md",children:[e.jsx(Je,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(U,{placeholder:"Search messages...",value:i.search,onChange:s=>g("search",s.target.value),className:"pl-9"})]}),e.jsxs(l,{variant:"outline",size:"sm",onClick:()=>de(!A),className:K(A&&"bg-muted"),children:[e.jsx(Ke,{className:"w-4 h-4 mr-2"}),"Filters",j>0&&e.jsx(Q,{variant:"secondary",className:"ml-2",children:j})]}),e.jsx("div",{className:"flex-1"}),e.jsxs(W,{value:n.perPage.toString(),onValueChange:s=>x(t=>({...t,perPage:parseInt(s),page:1})),children:[e.jsx(Z,{className:"w-[100px]",children:e.jsx(ee,{})}),e.jsx(se,{children:cs.map(s=>e.jsxs(z,{value:s.toString(),children:[s," / page"]},s))})]})]}),A&&e.jsx("div",{className:"p-4 bg-muted/50 rounded-lg space-y-3",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs(W,{value:i.status||"all",onValueChange:s=>g("status",s==="all"?"":s),children:[e.jsx(Z,{className:"w-[160px]",children:e.jsx(ee,{placeholder:"Status"})}),e.jsxs(se,{children:[e.jsx(z,{value:"all",children:"All Status"}),Object.entries($e).map(([s,t])=>e.jsx(z,{value:s,children:t},s))]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Qe,{className:"w-4 h-4 text-muted-foreground"}),e.jsx(U,{type:"date",placeholder:"From",value:i.date_from,onChange:s=>g("date_from",s.target.value),className:"w-[140px]"}),e.jsx("span",{className:"text-muted-foreground",children:"to"}),e.jsx(U,{type:"date",placeholder:"To",value:i.date_to,onChange:s=>g("date_to",s.target.value),className:"w-[140px]"})]}),e.jsx(l,{variant:"ghost",size:"sm",onClick:Y,children:"Clear Filters"})]})}),j>0&&e.jsx("div",{className:"flex flex-wrap items-center gap-2",children:Object.entries(i).filter(([,s])=>s).map(([s,t])=>e.jsxs(Q,{variant:"secondary",className:"gap-1 pr-1 cursor-pointer hover:bg-secondary/80",onClick:()=>g(s,""),children:[s,": ",t,e.jsx(ve,{className:"w-3 h-3 ml-1"})]},s))})]}),ue?e.jsx(qe,{columns:5,rows:5}):o.data.length===0?e.jsxs("div",{className:"text-center py-16",children:[e.jsx(ns,{className:"w-16 h-16 text-muted-foreground/50 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium",children:"No messages found"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:j>0?"Try adjusting your filters":"Your inbox is empty"}),j>0&&e.jsx(l,{variant:"outline",className:"mt-4",onClick:Y,children:"Clear Filters"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"rounded-md border",children:e.jsxs(be,{children:[e.jsx(Se,{children:e.jsxs(ae,{className:"bg-muted/50 hover:bg-muted/50",children:[e.jsx(N,{className:"cursor-pointer",onClick:()=>R("sender_name"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["From",M("sender_name")]})}),e.jsx(N,{className:"cursor-pointer",onClick:()=>R("subject"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["Subject",M("subject")]})}),e.jsx(N,{className:"cursor-pointer",onClick:()=>R("status"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["Status",M("status")]})}),e.jsx(N,{className:"cursor-pointer",onClick:()=>R("created_at"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["Received",M("created_at")]})}),e.jsx(N,{className:"w-10"})]})}),e.jsx(ke,{children:o.data.map(s=>e.jsxs(ae,{className:K("group cursor-pointer",s.status===c.UNREAD&&"bg-blue-50/50"),onClick:()=>F(s),children:[e.jsx(v,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`
                          w-10 h-10 rounded-full flex items-center justify-center text-sm font-medium
                          ${s.status===c.UNREAD?"bg-blue-100 text-blue-600":"bg-gray-100 text-gray-600"}
                        `,children:s.sender_name.split(" ").map(t=>t[0]).join("").slice(0,2).toUpperCase()}),e.jsxs("div",{children:[e.jsx("p",{className:`font-medium ${s.status===c.UNREAD?"text-foreground":""}`,children:s.sender_name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.sender_email})]})]})}),e.jsx(v,{children:e.jsxs("div",{children:[e.jsx("p",{className:`truncate max-w-[300px] ${s.status===c.UNREAD?"font-semibold":""}`,children:s.subject||"(No Subject)"}),e.jsxs("p",{className:"text-xs text-muted-foreground truncate max-w-[300px]",children:[s.message.substring(0,60),s.message.length>60?"...":""]})]})}),e.jsx(v,{children:e.jsx(te,{status:s.status,type:"message"})}),e.jsxs(v,{children:[e.jsx("div",{className:"text-sm",children:y(s.created_at)}),e.jsx("div",{className:"text-xs text-muted-foreground",children:Be(s.created_at)})]}),e.jsx(v,{onClick:t=>t.stopPropagation(),children:e.jsxs(_e,{children:[e.jsx(De,{asChild:!0,children:e.jsx(l,{variant:"ghost",size:"icon",className:"h-8 w-8 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(We,{className:"w-4 h-4"})})}),e.jsxs(Re,{align:"end",children:[e.jsxs(w,{onClick:()=>F(s),children:[e.jsx(we,{className:"w-4 h-4 mr-2"}),"View"]}),s.status===c.UNREAD&&e.jsxs(w,{onClick:()=>X(c.READ),children:[e.jsx(re,{className:"w-4 h-4 mr-2"}),"Mark as Read"]}),e.jsxs(w,{onClick:()=>{F(s),m(!0)},children:[e.jsx($,{className:"w-4 h-4 mr-2"}),"Reply"]}),s.status!==c.ARCHIVED&&e.jsxs(w,{onClick:()=>X(c.ARCHIVED),children:[e.jsx(Ze,{className:"w-4 h-4 mr-2"}),"Archive"]}),e.jsx(Me,{}),e.jsxs(w,{className:"text-red-600",onClick:()=>{E(s.id),u(!0)},children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Delete"]})]})]})})]},s.id))})]})}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",(n.page-1)*n.perPage+1," to"," ",Math.min(n.page*n.perPage,o.count)," of"," ",o.count," results"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{variant:"outline",size:"sm",onClick:()=>x(s=>({...s,page:s.page-1})),disabled:n.page===1,children:"Previous"}),e.jsxs("span",{className:"text-sm",children:["Page ",n.page," of ",Math.ceil(o.count/n.perPage)]}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>x(s=>({...s,page:s.page+1})),disabled:n.page>=Math.ceil(o.count/n.perPage),children:"Next"})]})]})]}),e.jsx(Le,{open:ce,onOpenChange:s=>{T(s),s||(m(!1),p(""))},children:e.jsx(He,{className:"w-full sm:max-w-xl overflow-hidden",children:a&&e.jsxs(e.Fragment,{children:[e.jsxs(Ve,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center text-white text-xl font-medium",children:a.sender_name.split(" ").map(s=>s[0]).join("").slice(0,2).toUpperCase()}),e.jsxs("div",{className:"flex-1",children:[e.jsx(Ge,{className:"text-xl",children:a.subject||"No Subject"}),e.jsx(Ye,{className:"text-base",children:a.sender_name}),e.jsx("div",{className:"flex items-center gap-2 mt-2",children:e.jsx(te,{status:a.status,type:"message"})})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 pt-2",children:[a.status!==c.REPLIED&&e.jsxs(l,{size:"sm",onClick:()=>m(!0),children:[e.jsx($,{className:"w-4 h-4 mr-2"}),"Reply"]}),e.jsxs(l,{variant:"outline",size:"sm",onClick:()=>window.open(`mailto:${a.sender_email}`),children:[e.jsx(le,{className:"w-4 h-4 mr-2"}),"Email"]}),e.jsxs(l,{variant:"destructive",size:"sm",onClick:()=>u(!0),children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Delete"]})]})]}),e.jsx(Xe,{className:"h-[calc(100vh-280px)] mt-6 pr-4",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs(C,{children:[e.jsx(b,{children:e.jsx(S,{className:"text-sm font-medium",children:"Sender Information"})}),e.jsxs(k,{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(le,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("a",{href:`mailto:${a.sender_email}`,className:"text-primary hover:underline",children:a.sender_email})]}),a.sender_phone&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(es,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("a",{href:`tel:${a.sender_phone}`,className:"hover:underline",children:a.sender_phone})]})]})]}),e.jsxs(C,{children:[e.jsx(b,{children:e.jsx(S,{className:"text-sm font-medium",children:"Message"})}),e.jsx(k,{children:e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:a.message})})]}),P.length>0&&e.jsxs(C,{className:"border-green-200 bg-green-50/50",children:[e.jsx(b,{children:e.jsxs(S,{className:"text-sm font-medium flex items-center gap-2 text-green-700",children:[e.jsx(re,{className:"w-4 h-4"}),"Your Replies (",P.length,")"]})}),e.jsx(k,{className:"space-y-4",children:P.map((s,t)=>e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-green-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-xs font-medium text-green-600",children:["Reply #",t+1]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:y(s.created_at)})]}),e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:s.reply_text})]},s.id))})]}),me&&e.jsxs(C,{className:"border-primary/20",children:[e.jsx(b,{children:e.jsxs(S,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx($,{className:"w-4 h-4"}),"New Reply"]})}),e.jsxs(k,{className:"space-y-3",children:[e.jsx(Ce,{value:h,onChange:s=>p(s.target.value),placeholder:"Type your reply...",className:"min-h-[150px]"}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(l,{variant:"outline",size:"sm",onClick:()=>{m(!1),p("")},children:"Cancel"}),e.jsxs(l,{size:"sm",onClick:ge,disabled:!h.trim(),children:[e.jsx(ss,{className:"w-4 h-4 mr-2"}),"Save Reply"]})]})]})]}),e.jsxs(C,{children:[e.jsx(b,{children:e.jsx(S,{className:"text-sm font-medium",children:"Timeline"})}),e.jsxs(k,{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Received"}),e.jsx("span",{children:y(a.created_at)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Last Updated"}),e.jsx("span",{children:y(a.updated_at)})]}),a.replied_at&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Replied"}),e.jsx("span",{children:y(a.replied_at)})]})]})]})]})})]})})}),e.jsx(Ee,{open:xe,onOpenChange:u,children:e.jsxs(Te,{children:[e.jsxs(Ae,{children:[e.jsx(Pe,{children:"Delete Message"}),e.jsxs(Fe,{children:["Are you sure you want to delete this message from ",a?.sender_name,"? This action cannot be undone."]})]}),e.jsxs(Ie,{children:[e.jsx(l,{variant:"outline",onClick:()=>u(!1),children:"Cancel"}),e.jsxs(l,{variant:"destructive",onClick:fe,children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Delete"]})]})]})})]})}export{Js as default};
