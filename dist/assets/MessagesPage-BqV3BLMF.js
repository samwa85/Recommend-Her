import{c as te,l as je,r as t,t as F,j as e,B as l,a as q,X as ge,E as fe,m as Ne}from"./index-CTBFlb6B.js";import{B as J}from"./badge-DXHBdx_O.js";import{I}from"./input-CEcI5SlG.js";import{T as ve}from"./textarea-NQnwRCyO.js";import{S as K,a as Q,b as W,c as Z,d as U}from"./select-B4WlMphl.js";import{T as we,a as Ce,b as ee,c as N,d as ye,e as v}from"./table-DX0S07ZN.js";import{D as be,a as Se,b as ke,c as w,d as De}from"./dropdown-menu-0vdZ_YEl.js";import{D as _e,a as Re,b as Me,c as Ee,d as Te,e as Ae}from"./dialog-B58eJIqf.js";import{y as Pe,z as Fe,M as i,A as Ie,B as Ue,g as k,f as ze,S as Oe,i as Le,j as $e,k as Be,l as He}from"./AdminLayout-DCDdeiUC.js";import{C as D,a as _,b as R,d as M}from"./card-DD8-8ij6.js";import{S as Ve}from"./scroll-area-iSDRfuRx.js";import{a as Ge}from"./LoadingSkeleton-BSkUv46_.js";import{S as se}from"./StatusBadge-BbZ50OBl.js";import{S as Xe}from"./search-Asy_H7bk.js";import{F as Ye}from"./funnel-64hG_8Sb.js";import{C as qe}from"./clock-BnyVGg6r.js";import{E as Je,T as z}from"./trash-2-H-8tYrTi.js";import{C as Ke}from"./circle-check-big-Bn8TQKMB.js";import{A as Qe}from"./archive-CRxaFYkv.js";import{M as ae}from"./mail-BiYN70Cu.js";import{P as We}from"./phone-ARypcb7x.js";import{S as Ze}from"./send-C55A5qks.js";import{A as es,a as ss,b as as}from"./arrow-up-CF3xpZN4.js";import"./index-DM13BidT.js";import"./index-D84yse_B.js";import"./index-y-owRkm1.js";import"./tslib.es6-eMSY344_.js";import"./index-DWK1vnJA.js";import"./index-BAoQ5eb0.js";import"./chevron-down-DoU3MspT.js";import"./index-HXy_8xgq.js";import"./client-Anx0SkdC.js";import"./errors-B3_eVdCY.js";import"./users-D8QL0r_i.js";import"./building-2-BA-C4eeT.js";import"./file-text-CpvjM4du.js";import"./message-square-Ke3EAdy9.js";import"./shield-DqvVlmHg.js";import"./bell-CuKgYaVz.js";import"./skeleton-DYSsuS3l.js";const ts=[["polyline",{points:"22 12 16 12 14 15 10 15 8 12 2 12",key:"o97t9d"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}]],rs=te("inbox",ts);const ls=[["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}],["path",{d:"m9 17-5-5 5-5",key:"nvlc11"}]],O=te("reply",ls),ns=[10,25,50,100];function Ys(){const[L,C]=je(),[re,E]=t.useState(null),[le,T]=t.useState(!1),[c,$]=t.useState({status:L.get("status")||"",search:L.get("search")||"",date_from:"",date_to:""}),[A,ne]=t.useState(!1),[B,ie]=t.useState({key:"created_at",direction:"desc"}),[n,h]=t.useState({page:1,perPage:25}),[y,p]=t.useState(""),[ce,m]=t.useState(!1),[oe,u]=t.useState(!1),de=t.useMemo(()=>({status:c.status||void 0,search:c.search||void 0}),[c.status,c.search]),me=t.useMemo(()=>({page:n.page,perPage:n.perPage}),[n.page,n.perPage]),{data:d,isLoading:xe,error:H,refresh:o}=Pe({filters:de,pagination:me,autoRefresh:!0}),{data:a,updateStatus:x}=Fe(re),j=Object.values(c).filter(Boolean).length,he=d.data.filter(s=>s.status===i.UNREAD).length,g=t.useCallback((s,r)=>{$(f=>({...f,[s]:r})),h(f=>({...f,page:1}));const X=new URLSearchParams;Object.entries({...c,[s]:r}).forEach(([f,Y])=>{Y&&X.set(f,Y)}),C(X)},[c,C]),V=t.useCallback(()=>{$({status:"",search:"",date_from:"",date_to:""}),h(s=>({...s,page:1})),C(new URLSearchParams)},[C]),b=t.useCallback(s=>{ie(r=>({key:s,direction:r.key===s&&r.direction==="asc"?"desc":"asc"}))},[]),P=t.useCallback(async s=>{E(s.id),m(!1),p(""),s.status===i.UNREAD&&(await x(i.READ),o()),T(!0)},[x,o]),G=t.useCallback(async s=>{F.promise(async()=>{if((await x(s)).success)return o(),`Message ${s}`;throw new Error("Failed to update status")},{loading:"Updating...",success:`Message marked as ${s}`,error:"Failed to update message"})},[x,o]),pe=t.useCallback(async()=>{y.trim()&&F.promise(async()=>(await x(i.REPLIED),m(!1),p(""),o(),"Reply sent"),{loading:"Sending reply...",success:"Reply sent successfully",error:"Failed to send reply"})},[y,x,o]),ue=t.useCallback(async()=>{u(!1),T(!1),E(null),F.success("Message deleted"),o()},[o]),S=s=>B.key!==s?e.jsx(es,{className:"w-3.5 h-3.5 text-muted-foreground/50"}):B.direction==="asc"?e.jsx(ss,{className:"w-3.5 h-3.5 text-primary"}):e.jsx(as,{className:"w-3.5 h-3.5 text-primary"});return e.jsxs(Ie,{title:"Messages",subtitle:`${d.count} total messages â€¢ ${he} unread`,actions:e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(l,{variant:"outline",size:"sm",onClick:o,children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"Refresh"]})}),children:[H&&e.jsxs("div",{className:"mb-4 p-4 rounded-lg bg-red-50 text-red-600 text-sm",children:[H,e.jsx(l,{variant:"link",onClick:o,className:"ml-2",children:"Retry"})]}),e.jsxs("div",{className:"mb-6 space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("div",{className:"relative flex-1 min-w-[300px] max-w-md",children:[e.jsx(Xe,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(I,{placeholder:"Search messages...",value:c.search,onChange:s=>g("search",s.target.value),className:"pl-9"})]}),e.jsxs(l,{variant:"outline",size:"sm",onClick:()=>ne(!A),className:q(A&&"bg-muted"),children:[e.jsx(Ye,{className:"w-4 h-4 mr-2"}),"Filters",j>0&&e.jsx(J,{variant:"secondary",className:"ml-2",children:j})]}),e.jsx("div",{className:"flex-1"}),e.jsxs(K,{value:n.perPage.toString(),onValueChange:s=>h(r=>({...r,perPage:parseInt(s),page:1})),children:[e.jsx(Q,{className:"w-[100px]",children:e.jsx(W,{})}),e.jsx(Z,{children:ns.map(s=>e.jsxs(U,{value:s.toString(),children:[s," / page"]},s))})]})]}),A&&e.jsx("div",{className:"p-4 bg-muted/50 rounded-lg space-y-3",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs(K,{value:c.status||"all",onValueChange:s=>g("status",s==="all"?"":s),children:[e.jsx(Q,{className:"w-[160px]",children:e.jsx(W,{placeholder:"Status"})}),e.jsxs(Z,{children:[e.jsx(U,{value:"all",children:"All Status"}),Object.entries(Ue).map(([s,r])=>e.jsx(U,{value:s,children:r},s))]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(qe,{className:"w-4 h-4 text-muted-foreground"}),e.jsx(I,{type:"date",placeholder:"From",value:c.date_from,onChange:s=>g("date_from",s.target.value),className:"w-[140px]"}),e.jsx("span",{className:"text-muted-foreground",children:"to"}),e.jsx(I,{type:"date",placeholder:"To",value:c.date_to,onChange:s=>g("date_to",s.target.value),className:"w-[140px]"})]}),e.jsx(l,{variant:"ghost",size:"sm",onClick:V,children:"Clear Filters"})]})}),j>0&&e.jsx("div",{className:"flex flex-wrap items-center gap-2",children:Object.entries(c).filter(([,s])=>s).map(([s,r])=>e.jsxs(J,{variant:"secondary",className:"gap-1 pr-1 cursor-pointer hover:bg-secondary/80",onClick:()=>g(s,""),children:[s,": ",r,e.jsx(ge,{className:"w-3 h-3 ml-1"})]},s))})]}),xe?e.jsx(Ge,{columns:5,rows:5}):d.data.length===0?e.jsxs("div",{className:"text-center py-16",children:[e.jsx(rs,{className:"w-16 h-16 text-muted-foreground/50 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium",children:"No messages found"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:j>0?"Try adjusting your filters":"Your inbox is empty"}),j>0&&e.jsx(l,{variant:"outline",className:"mt-4",onClick:V,children:"Clear Filters"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"rounded-md border",children:e.jsxs(we,{children:[e.jsx(Ce,{children:e.jsxs(ee,{className:"bg-muted/50 hover:bg-muted/50",children:[e.jsx(N,{className:"cursor-pointer",onClick:()=>b("sender_name"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["From",S("sender_name")]})}),e.jsx(N,{className:"cursor-pointer",onClick:()=>b("subject"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["Subject",S("subject")]})}),e.jsx(N,{className:"cursor-pointer",onClick:()=>b("status"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["Status",S("status")]})}),e.jsx(N,{className:"cursor-pointer",onClick:()=>b("created_at"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["Received",S("created_at")]})}),e.jsx(N,{className:"w-10"})]})}),e.jsx(ye,{children:d.data.map(s=>e.jsxs(ee,{className:q("group cursor-pointer",s.status===i.UNREAD&&"bg-blue-50/50"),onClick:()=>P(s),children:[e.jsx(v,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`
                          w-10 h-10 rounded-full flex items-center justify-center text-sm font-medium
                          ${s.status===i.UNREAD?"bg-blue-100 text-blue-600":"bg-gray-100 text-gray-600"}
                        `,children:s.sender_name.split(" ").map(r=>r[0]).join("").slice(0,2).toUpperCase()}),e.jsxs("div",{children:[e.jsx("p",{className:`font-medium ${s.status===i.UNREAD?"text-foreground":""}`,children:s.sender_name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.sender_email})]})]})}),e.jsx(v,{children:e.jsxs("div",{children:[e.jsx("p",{className:`truncate max-w-[300px] ${s.status===i.UNREAD?"font-semibold":""}`,children:s.subject||"(No Subject)"}),e.jsxs("p",{className:"text-xs text-muted-foreground truncate max-w-[300px]",children:[s.message.substring(0,60),s.message.length>60?"...":""]})]})}),e.jsx(v,{children:e.jsx(se,{status:s.status,type:"message"})}),e.jsxs(v,{children:[e.jsx("div",{className:"text-sm",children:k(s.created_at)}),e.jsx("div",{className:"text-xs text-muted-foreground",children:ze(s.created_at)})]}),e.jsx(v,{onClick:r=>r.stopPropagation(),children:e.jsxs(be,{children:[e.jsx(Se,{asChild:!0,children:e.jsx(l,{variant:"ghost",size:"icon",className:"h-8 w-8 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(Je,{className:"w-4 h-4"})})}),e.jsxs(ke,{align:"end",children:[e.jsxs(w,{onClick:()=>P(s),children:[e.jsx(fe,{className:"w-4 h-4 mr-2"}),"View"]}),s.status===i.UNREAD&&e.jsxs(w,{onClick:()=>G(i.READ),children:[e.jsx(Ke,{className:"w-4 h-4 mr-2"}),"Mark as Read"]}),e.jsxs(w,{onClick:()=>{P(s),m(!0)},children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Reply"]}),s.status!==i.ARCHIVED&&e.jsxs(w,{onClick:()=>G(i.ARCHIVED),children:[e.jsx(Qe,{className:"w-4 h-4 mr-2"}),"Archive"]}),e.jsx(De,{}),e.jsxs(w,{className:"text-red-600",onClick:()=>{E(s.id),u(!0)},children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),"Delete"]})]})]})})]},s.id))})]})}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",(n.page-1)*n.perPage+1," to"," ",Math.min(n.page*n.perPage,d.count)," of"," ",d.count," results"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{variant:"outline",size:"sm",onClick:()=>h(s=>({...s,page:s.page-1})),disabled:n.page===1,children:"Previous"}),e.jsxs("span",{className:"text-sm",children:["Page ",n.page," of ",Math.ceil(d.count/n.perPage)]}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>h(s=>({...s,page:s.page+1})),disabled:n.page>=Math.ceil(d.count/n.perPage),children:"Next"})]})]})]}),e.jsx(Oe,{open:le,onOpenChange:s=>{T(s),s||(m(!1),p(""))},children:e.jsx(Le,{className:"w-full sm:max-w-xl overflow-hidden",children:a&&e.jsxs(e.Fragment,{children:[e.jsxs($e,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center text-white text-xl font-medium",children:a.sender_name.split(" ").map(s=>s[0]).join("").slice(0,2).toUpperCase()}),e.jsxs("div",{className:"flex-1",children:[e.jsx(Be,{className:"text-xl",children:a.subject||"No Subject"}),e.jsx(He,{className:"text-base",children:a.sender_name}),e.jsx("div",{className:"flex items-center gap-2 mt-2",children:e.jsx(se,{status:a.status,type:"message"})})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 pt-2",children:[a.status!==i.REPLIED&&e.jsxs(l,{size:"sm",onClick:()=>m(!0),children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Reply"]}),e.jsxs(l,{variant:"outline",size:"sm",onClick:()=>window.open(`mailto:${a.sender_email}`),children:[e.jsx(ae,{className:"w-4 h-4 mr-2"}),"Email"]}),e.jsxs(l,{variant:"destructive",size:"sm",onClick:()=>u(!0),children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),"Delete"]})]})]}),e.jsx(Ve,{className:"h-[calc(100vh-280px)] mt-6 pr-4",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs(D,{children:[e.jsx(_,{children:e.jsx(R,{className:"text-sm font-medium",children:"Sender Information"})}),e.jsxs(M,{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("a",{href:`mailto:${a.sender_email}`,className:"text-primary hover:underline",children:a.sender_email})]}),a.sender_phone&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(We,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("a",{href:`tel:${a.sender_phone}`,className:"hover:underline",children:a.sender_phone})]})]})]}),e.jsxs(D,{children:[e.jsx(_,{children:e.jsx(R,{className:"text-sm font-medium",children:"Message"})}),e.jsx(M,{children:e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:a.message})})]}),ce&&e.jsxs(D,{className:"border-primary/20",children:[e.jsx(_,{children:e.jsxs(R,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(O,{className:"w-4 h-4"}),"Reply"]})}),e.jsxs(M,{className:"space-y-3",children:[e.jsx(ve,{value:y,onChange:s=>p(s.target.value),placeholder:"Type your reply...",className:"min-h-[150px]"}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(l,{variant:"outline",size:"sm",onClick:()=>{m(!1),p("")},children:"Cancel"}),e.jsxs(l,{size:"sm",onClick:pe,disabled:!y.trim(),children:[e.jsx(Ze,{className:"w-4 h-4 mr-2"}),"Send Reply"]})]})]})]}),e.jsxs(D,{children:[e.jsx(_,{children:e.jsx(R,{className:"text-sm font-medium",children:"Timeline"})}),e.jsxs(M,{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Received"}),e.jsx("span",{children:k(a.created_at)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Last Updated"}),e.jsx("span",{children:k(a.updated_at)})]}),a.replied_at&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Replied"}),e.jsx("span",{children:k(a.replied_at)})]})]})]})]})})]})})}),e.jsx(_e,{open:oe,onOpenChange:u,children:e.jsxs(Re,{children:[e.jsxs(Me,{children:[e.jsx(Ee,{children:"Delete Message"}),e.jsxs(Te,{children:["Are you sure you want to delete this message from ",a?.sender_name,"? This action cannot be undone."]})]}),e.jsxs(Ae,{children:[e.jsx(l,{variant:"outline",onClick:()=>u(!1),children:"Cancel"}),e.jsxs(l,{variant:"destructive",onClick:ue,children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),"Delete"]})]})]})})]})}export{Ys as default};
